openapi: 3.0.0
info:
  title: "SADI - Unified API"
  version: "1.0.0"
  description: "The single source of truth for the SADI API, enforcing a session-state architecture."

paths:
  /unified/v1/mcp/session/create:
    post:
      summary: "Create Session"
      operationId: "create_session"
      responses:
        '200':
          description: "Session created successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Session'

  /unified/v1/mpa/ingestion/upload-file/:
    post:
      summary: "Upload File"
      operationId: "upload_file"
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                session_id:
                  type: string
                  format: uuid
                file:
                  type: string
                  format: binary
      responses:
        '200':
          description: "File uploaded and processed successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  session_id:
                    type: string
                    format: uuid
                  filename:
                    type: string

  /unified/v1/mpa/quality/report:
    post:
      summary: "Get Data Quality Report"
      operationId: "get_quality_report"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionRequest'
      responses:
        '200':
          description: "Data quality report generated successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QualityReport'

  /unified/v1/chat/agent/:
    post:
      summary: "Chat with Agent"
      operationId: "chat_agent"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatAgentRequest'
      responses:
        '200':
          description: "Agent response."
          content:
            application/json:
              schema:
                type: object
                properties:
                  output:
                    type: string

  /unified/v1/wpa/modeling/train:
    post:
      summary: "Train Model (WPA)"
      operationId: "train_model_wpa"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ModelTrainRequest'
      responses:
        '200':
          description: "Model training started."

components:
  schemas:
    Session:
      type: object
      properties:
        session_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time

    SessionRequest:
      type: object
      required:
        - session_id
      properties:
        session_id:
          type: string
          format: uuid

    ChatAgentRequest:
      type: object
      required:
        - session_id
        - message
      properties:
        session_id:
          type: string
          format: uuid
        message:
          type: string

    ModelTrainRequest:
      type: object
      required:
        - session_id
        - model_type
        - target_column
        - feature_columns
      properties:
        session_id:
          type: string
          format: uuid
        model_type:
          type: string
          enum: ["random_forest", "svm", "linear_regression"]
        target_column:
          type: string
        feature_columns:
          type: array
          items:
            type: string

    QualityReport:
      type: object
      properties:
        health_score:
          type: number
          format: float
        columns:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              missing_values:
                type: integer
              data_type:
                type: string
